{% extends 'reports/base_report.html' %}

{% block report_title %}Regularization Report{% endblock %}

{% block report_icon %}
<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
</svg>
{% endblock %}

{% block report_heading %}✏️ Regularization Report{% endblock %}
{% block report_description %}All attendance records for regularization tracking{% endblock %}

{% block report_content %}
<div class="bg-white border border-light-blue rounded-xl overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full text-left text-black text-sm min-w-max">
            <thead class="text-xs font-bold uppercase bg-dark-blue text-cream">
                <tr>
                    <th class="px-3 py-2 whitespace-nowrap border-r border-cream/20">EP NO</th>
                    <th class="px-3 py-2 whitespace-nowrap border-r border-cream/20">EP NAME</th>
                    <th class="px-3 py-2 whitespace-nowrap text-center border-r border-cream/20">DATE</th>
                    <th class="px-3 py-2 whitespace-nowrap text-center border-r border-cream/20">OLD IN</th>
                    <th class="px-3 py-2 whitespace-nowrap text-center border-r border-cream/20">OLD OUT</th>
                    <th class="px-3 py-2 whitespace-nowrap text-center border-r border-cream/20">NEW IN</th>
                    <th class="px-3 py-2 whitespace-nowrap text-center border-r border-cream/20">NEW OUT</th>
                    <th class="px-3 py-2 whitespace-nowrap border-r border-cream/20">REMARKS</th>
                    <th class="px-3 py-2 whitespace-nowrap border-r border-cream/20">REASON</th>
                    <th class="px-3 py-2 whitespace-nowrap border-r border-cream/20">EIC NAME</th>
                    <th class="px-3 py-2 whitespace-nowrap text-center">STATUS</th>
                </tr>
            </thead>
            <tbody>
                {% for record in page_obj %}
                <tr class="{% cycle 'bg-white' 'bg-cream/30' %} hover:bg-light-blue/20 transition border-b border-light-blue/50">
                    <td class="px-3 py-2 font-bold text-dark-blue border-r border-light-blue/20">{{ record.ep_no }}</td>
                    <td class="px-3 py-2 font-semibold border-r border-light-blue/20">{{ record.ep_name }}</td>
                    <td class="px-3 py-2 text-center border-r border-light-blue/20">{{ record.date|date:"d/m/Y" }}</td>
                    <td class="px-3 py-2 text-center border-r border-light-blue/20">{% if record.in_time %}{{ record.in_time|time:"H:i" }}{% else %}-{% endif %}</td>
                    <td class="px-3 py-2 text-center border-r border-light-blue/20">{% if record.out_time %}{{ record.out_time|time:"H:i" }}{% else %}-{% endif %}</td>
                    <td class="px-3 py-2 text-center border-r border-light-blue/20">{% if record.in_time_2 %}{{ record.in_time_2|time:"H:i" }}{% else %}-{% endif %}</td>
                    <td class="px-3 py-2 text-center border-r border-light-blue/20">{% if record.out_time_2 %}{{ record.out_time_2|time:"H:i" }}{% else %}-{% endif %}</td>
                    <td class="px-3 py-2 text-xs border-r border-light-blue/20">{{ record.contractor_ot_remarks|truncatewords:5|default:"-" }}</td>
                    <td class="px-3 py-2 text-xs border-r border-light-blue/20">{{ record.contractor_ot_reason|truncatewords:5|default:"-" }}</td>
                    <td class="px-3 py-2 border-r border-light-blue/20">{{ record.requested_eic_name|default:"-" }}</td>
                    <td class="px-3 py-2 text-center">
                        {% if record.ot_request_status == 'Approved' %}
                        <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-semibold">✓</span>
                        {% elif record.ot_request_status == 'Rejected' %}
                        <span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-semibold">✗</span>
                        {% elif record.ot_request_status == 'Pending' %}
                        <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-semibold">⏳</span>
                        {% else %}
                        <span class="text-black/50">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="11" class="px-3 py-8 text-center text-black/50">
                        <svg class="w-12 h-12 mx-auto mb-2 text-black/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        <p class="font-semibold">No records found</p>
                        <p class="text-xs mt-1">Try adjusting your filters</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
